<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>AirAware AI - Premium Monitoring</title>
    <link rel="stylesheet" href="style.css">

    <!-- Leaflet (OpenStreetMap) - Free, No Token Needed -->
    <link rel="stylesheet" href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css"
        integrity="sha256-p4NxAoJBhIIN+hmNHrzRCf9tD/miZyoHS5obTRR9BMY=" crossorigin="" />
    <script src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js"
        integrity="sha256-20nQCchB9co0qIjJZRGuk2/Z9VM+kNiyxNV1lvTlZBo=" crossorigin=""></script>
    <!-- Leaflet Heatmap Plugin -->
    <script src="https://leaflet.github.io/Leaflet.heat/dist/leaflet-heat.js"></script>
</head>

<body>

    <div class="app-container">
        <!-- Sidebar Navigation -->
        <aside class="sidebar">
            <div class="brand">
                <div class="brand-icon">‚ú®</div>
                <div class="brand-text">
                    <h1>AirAware AI</h1>
                </div>
            </div>

            <div class="control-group">
                <label class="control-label">Active Pollutant</label>
                <select id="gasSelector" class="custom-select">
                    <option value="" disabled>Loading data...</option>
                </select>
            </div>

            <div class="control-group">
                <label class="control-label">Map Layers</label>
                <!-- Toggles for new features -->
                <button id="toggleArrowsBtn" class="btn btn-secondary">
                    ‚ÜóÔ∏è Toggle Movement
                </button>
                <button id="toggleHeatmapBtn" class="btn btn-secondary" style="margin-top: 8px;">
                    üî• Toggle Heat Map
                </button>
            </div>

            <div class="control-group">
                <details class="custom-details" open>
                    <summary class="control-label"
                        style="cursor: pointer; display: flex; align-items: center; gap: 8px;">
                        üìä Data Contributions
                        <span style="font-size: 0.7rem; color: var(--text-muted); margin-left: auto;">‚ñº</span>
                    </summary>
                    <div id="sourceStats" class="source-list" style="margin-top: 10px;">
                        <div style="font-size: 0.8rem; color: var(--text-muted);">Loading sources...</div>
                    </div>
                </details>
            </div>

            <div class="control-group" style="margin-top: auto;">
                <button id="refreshBtn" class="btn btn-primary">
                    üîÑ Refresh Data
                </button>
            </div>

            <div class="status-panel">
                <div
                    style="display: flex; align-items: center; gap: 8px; font-size: 0.8rem; color: var(--text-muted); margin-top: 10px;">
                    <div class="live-indicator"></div>
                    Backend System Active
                </div>
            </div>
        </aside>

        <!-- Main Dashboard -->
        <main class="main-content">
            <!-- Top Stats Deck -->
            <div class="stats-row">
                <div class="stat-card">
                    <div class="stat-title">Average Level</div>
                    <div class="stat-value"><span id="avgValue">--</span> <span class="stat-unit"
                            id="avgUnit">¬µg/m¬≥</span></div>
                </div>
                <div class="stat-card">
                    <div class="stat-title">Peak Value</div>
                    <div class="stat-value"><span id="maxValue">--</span> <span class="stat-unit"
                            id="maxUnit">¬µg/m¬≥</span></div>
                </div>
                <div class="stat-card">
                    <div class="stat-title">Station Count</div>
                    <div class="stat-value" id="stationCount">--</div>
                </div>
                <div class="stat-card">
                    <div class="stat-title">AI Status</div>
                    <div class="stat-value" style="font-size: 1.2rem; color: var(--accent-success);">Online</div>
                </div>
            </div>

            <!-- Map Deck -->
            <div class="map-kiosk">
                <div id="map"></div>

                <!-- Map Legend Overlay -->
                <div class="map-overlay">
                    <div class="legend-item">
                        <div class="color-dot" style="background:#00E400"></div> Good
                    </div>
                    <div class="legend-item">
                        <div class="color-dot" style="background:#FFFF00"></div> Moderate
                    </div>
                    <div class="legend-item">
                        <div class="color-dot" style="background:#FF7E00"></div> Unhealthy (Sens.)
                    </div>
                    <div class="legend-item">
                        <div class="color-dot" style="background:#FF0000"></div> Unhealthy
                    </div>
                    <div class="legend-item">
                        <div class="color-dot" style="background:#8F3F97"></div> Very Unhealthy
                    </div>
                    <div class="legend-item">
                        <div class="color-dot" style="background:#7E0023"></div> Hazardous
                    </div>
                </div>
            </div>

            <!-- Warnings Deck (New) -->
            <div id="alertsContainer" class="alerts-section">
                <!-- Alerts injected here -->
            </div>

            <!-- Lower Deck -->
            <div class="lower-deck">
                <!-- AI Prediction Panel -->
                <div class="panel">
                    <h2>ü§ñ AI Forecaster</h2>
                    <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 16px;">
                        <input type="number" id="latitude" class="custom-select" placeholder="Lat (e.g. 28.61)"
                            step="0.01">
                        <input type="number" id="longitude" class="custom-select" placeholder="Lon (e.g. 77.21)"
                            step="0.01">
                    </div>
                    <button id="predictBtn" class="btn btn-primary" style="margin-top: 16px;">
                        Predict Pollution Level
                    </button>
                    <div id="predictionResult"
                        style="margin-top: 16px; padding: 12px; background: rgba(0,0,0,0.2); border-radius: 8px; display: none;">
                        <!-- Result injected here -->
                    </div>
                </div>

                <!-- Hotspots Panel -->
                <div class="panel">
                    <h2>üö® Top Hotspots</h2>
                    <div id="hotspotsList" style="display: flex; flex-direction: column; gap: 10px;">
                        <!-- JS injected hotspots -->
                        <div style="color: var(--text-muted); font-size: 0.9rem;">Loading hotspots...</div>
                    </div>
                </div>
            </div>
        </main>
    </div>

    <!-- AI Chatbot Interface (Floating) -->
    <div class="chatbot-fab" id="chatbotToggle">
        ü§ñ
    </div>

    <div class="chat-window" id="chatWindow">
        <div class="chat-header">
            <h3>AirAware Assistant</h3>
            <span style="cursor: pointer;" id="closeChat">‚úï</span>
        </div>
        <div class="chat-messages" id="chatMessages">
            <div class="message bot">
                Hello! I'm your AI environmental assistant. Ask me anything about air quality in India today. üåø
            </div>
        </div>
        <div class="chat-input-area">
            <input type="text" id="chatInput" class="chat-input" placeholder="Ask AI...">
            <button class="send-btn" id="sendMessage">‚û§</button>
        </div>
    </div>

    <script src="script.js"></script>
</body>

</html>