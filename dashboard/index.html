<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>AirAware AI - Premium Monitoring</title>
    <link rel="stylesheet" href="style.css">

    <!-- Leaflet (OpenStreetMap) - Free, No Token Needed -->
    <link rel="stylesheet" href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css"
        integrity="sha256-p4NxAoJBhIIN+hmNHrzRCf9tD/miZyoHS5obTRR9BMY=" crossorigin="" />
    <script src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js"
        integrity="sha256-20nQCchB9co0qIjJZRGuk2/Z9VM+kNiyxNV1lvTlZBo=" crossorigin=""></script>
    <!-- Leaflet Heatmap Plugin -->
    <script src="https://leaflet.github.io/Leaflet.heat/dist/leaflet-heat.js"></script>

    <!-- Chart.js for AI Forecasting -->
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
</head>

<body>

    <div class="app-container">
        <!-- Sidebar Navigation -->
        <aside class="sidebar">
            <div class="brand">
                <div class="brand-icon">‚ú®</div>
                <div class="brand-text">
                    <h1>AirAware AI</h1>
                </div>
            </div>

            <div class="control-group">
                <label class="control-label">Active Pollutant</label>
                <select id="gasSelector" class="custom-select">
                    <option value="" disabled>Loading data...</option>
                </select>
            </div>

            <div class="control-group">
                <label class="control-label">Map Layers</label>
                <!-- Toggles for new features -->
                <button id="toggleArrowsBtn" class="btn btn-secondary">
                    ‚ÜóÔ∏è Toggle Movement
                </button>
                <button id="toggleHeatmapBtn" class="btn btn-secondary" style="margin-top: 8px;">
                    üî• Toggle Heat Map
                </button>
            </div>

            <div class="control-group">
                <details class="custom-details" open>
                    <summary class="control-label"
                        style="cursor: pointer; display: flex; align-items: center; gap: 8px;">
                        üìä Data Contributions
                        <span style="font-size: 0.7rem; color: var(--text-muted); margin-left: auto;">‚ñº</span>
                    </summary>
                    <div id="sourceStats" class="source-list" style="margin-top: 10px;">
                        <div style="font-size: 0.8rem; color: var(--text-muted);">Loading sources...</div>
                    </div>
                </details>
            </div>

            <div class="control-group" style="margin-top: auto;">
                <button id="refreshBtn" class="btn btn-primary">
                    üîÑ Refresh Data
                </button>
            </div>

            <div class="status-panel">
                <div
                    style="display: flex; align-items: center; gap: 8px; font-size: 0.8rem; color: var(--text-muted); margin-top: 10px;">
                    <div class="live-indicator"></div>
                    Backend System Active
                </div>
            </div>
        </aside>

        <!-- Main Dashboard -->
        <main class="main-content">
            <!-- Theme Toggle Button (Top Right) -->
            <button id="toggleThemeBtn" class="theme-toggle-btn" title="Toggle Day/Night Mode">
                üåô
            </button>
            <!-- Top Stats Deck -->
            <div class="stats-row">
                <div class="stat-card">
                    <div class="stat-title">Average Level</div>
                    <div class="stat-value"><span id="avgValue">--</span> <span class="stat-unit"
                            id="avgUnit">¬µg/m¬≥</span></div>
                </div>
                <div class="stat-card">
                    <div class="stat-title">Peak Value</div>
                    <div class="stat-value"><span id="maxValue">--</span> <span class="stat-unit"
                            id="maxUnit">¬µg/m¬≥</span></div>
                </div>
                <div class="stat-card">
                    <div class="stat-title">Station Count</div>
                    <div class="stat-value" id="stationCount">--</div>
                </div>
                <div class="stat-card">
                    <div class="stat-title">AI Status</div>
                    <div class="stat-value" style="font-size: 1.2rem; color: var(--accent-success);">Online</div>
                </div>
            </div>

            <!-- Map Deck -->
            <div class="map-kiosk">
                <div id="map"></div>

                <!-- Map Legend Overlay -->
                <div class="map-overlay">
                    <div class="legend-item">
                        <div class="color-dot" style="background:#00E400"></div> Good
                    </div>
                    <div class="legend-item">
                        <div class="color-dot" style="background:#FFFF00"></div> Moderate
                    </div>
                    <div class="legend-item">
                        <div class="color-dot" style="background:#FF7E00"></div> Unhealthy (Sens.)
                    </div>
                    <div class="legend-item">
                        <div class="color-dot" style="background:#FF0000"></div> Unhealthy
                    </div>
                    <div class="legend-item">
                        <div class="color-dot" style="background:#8F3F97"></div> Very Unhealthy
                    </div>
                    <div class="legend-item">
                        <div class="color-dot" style="background:#7E0023"></div> Hazardous
                    </div>
                </div>
            </div>

            <!-- Warnings Deck (New) -->
            <div id="alertsContainer" class="alerts-section">
                <!-- Alerts injected here -->
            </div>

            <!-- Lower Deck -->
            <div class="lower-deck">
                <!-- AI Prediction Panel -->
                <div class="panel">
                    <h2>ü§ñ AI Forecaster</h2>
                    <div class="glass-card" style="margin-bottom: 20px;">
                        <h3 style="font-size: 1.1rem; margin-bottom: 16px;">Select Indian City</h3>

                        <select id="citySelector" class="custom-select" style="margin-bottom: 14px;">
                            <option value="">-- Choose a city --</option>
                            <option value="Delhi" data-lat="28.6139" data-lon="77.2090">Delhi</option>
                            <option value="Mumbai" data-lat="19.0760" data-lon="72.8777">Mumbai</option>
                            <option value="Bangalore" data-lat="12.9716" data-lon="77.5946">Bangalore</option>
                            <option value="Chennai" data-lat="13.0827" data-lon="80.2707">Chennai</option>
                            <option value="Kolkata" data-lat="22.5726" data-lon="88.3639">Kolkata</option>
                            <option value="Hyderabad" data-lat="17.3850" data-lon="78.4867">Hyderabad</option>
                            <option value="Pune" data-lat="18.5204" data-lon="73.8567">Pune</option>
                            <option value="Ahmedabad" data-lat="23.0225" data-lon="72.5714">Ahmedabad</option>
                            <option value="Jaipur" data-lat="26.9124" data-lon="75.7873">Jaipur</option>
                            <option value="Lucknow" data-lat="26.8467" data-lon="80.9462">Lucknow</option>
                            <option value="Kanpur" data-lat="26.4499" data-lon="80.3319">Kanpur</option>
                            <option value="Nagpur" data-lat="21.1458" data-lon="79.0882">Nagpur</option>
                            <option value="Visakhapatnam" data-lat="17.6868" data-lon="83.2185">Visakhapatnam</option>
                            <option value="Bhopal" data-lat="23.2599" data-lon="77.4126">Bhopal</option>
                            <option value="Patna" data-lat="25.5941" data-lon="85.1376">Patna</option>
                        </select>

                        <div style="display:flex; gap:10px; margin-bottom: 10px;">
                            <button class="btn btn-primary" id="locateMeBtn" style="flex:1">üìç Use My Location</button>
                        </div>

                        <div style="font-size: 0.8rem; color: var(--text-muted); text-align: center; margin-bottom: 10px;"
                            id="selectedCoords">
                            Select a city to see coordinates
                        </div>

                        <div style="display:flex; gap:10px;">
                            <button class="btn btn-secondary" id="predictBtn" style="flex:1">Predict Now</button>
                            <button class="btn btn-primary" id="forecastBtn"
                                style="flex:1; background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);">Stats
                                & Forecast üìà</button>
                        </div>

                        <div id="predictionResult"
                            style="margin-top:10px; padding:10px; background:rgba(0,0,0,0.2); border-radius:8px; display:none; text-align:center;">
                            <!-- Result here -->
                        </div>
                    </div> <!-- End AI Forecaster Panel -->

                    <!-- Forecast Modal (Hidden) -->
                    <div id="forecastModal"
                        style="display:none; position:fixed; top:0; left:0; width:100%; height:100%; background:rgba(0,0,0,0.8); z-index:9999; justify-content:center; align-items:center;">
                        <div class="glass-card" style="width:90%; max-width:800px; padding:20px; position:relative;">
                            <button id="closeForecast"
                                style="position:absolute; top:15px; right:15px; background:none; border:none; color:white; font-size:1.5rem; cursor:pointer;">&times;</button>
                            <h2 id="forecastTitle" style="margin-bottom:20px;">AI Forecast</h2>
                            <canvas id="forecastChart"></canvas>
                            <div id="forecastStatus" style="text-align:center; margin-top:10px; color:#aaa;">
                                Loading...
                            </div>
                        </div>
                    </div>

                    <!-- Hotspots Panel -->
                    <div class="panel">
                        <h2>üö® Top Hotspots</h2>
                        <div id="hotspotsList" style="display: flex; flex-direction: column; gap: 10px;">
                            <!-- JS injected hotspots -->
                            <div style="color: var(--text-muted); font-size: 0.9rem;">Loading hotspots...</div>
                        </div>
                    </div>
                </div> <!-- End Lower Deck -->
        </main>
    </div>

    <!-- AI Chatbot Interface (Floating) -->
    <div class="chatbot-fab" id="chatbotToggle">
        ü§ñ
    </div>

    <div class="chat-window" id="chatWindow">
        <div class="chat-header">
            <h3>AirAware Assistant</h3>
            <span style="cursor: pointer;" id="closeChat">‚úï</span>
        </div>
        <div class="chat-messages" id="chatMessages">
            <div class="message bot">
                Hello! I'm your AI environmental assistant. Ask me anything about air quality in India today. üåø
            </div>
        </div>
        <div class="chat-input-area">
            <input type="text" id="chatInput" class="chat-input" placeholder="Ask AI...">
            <button class="send-btn" id="sendMessage">‚û§</button>
        </div>
    </div>

    <script src="script.js"></script>
</body>

</html>